Objective:

One of the most frustrating things about reading a webcomic or other serialized story is when a character or location or item re-appears after not having been mentioned for months or years and suddenly the reader is left either digging through source material to figure out who or what is being discussed, or (more often) simply accepting that they will be confused with the story for a bit, but hoping that context cludes further on will remind them of what's going on. Serialized web stories almost always have a "characters" page - this can fill in the gaps to some extent, but almost always it's designed to be as spoiler free as possible, which means that the information you're looking for is rarely ever there.

The goal of this project is to create a "characters" page that updates as the story moves forward. It's designed specifically to determine what page is "current" based on the referrer URI (what page linked to it) and not show any data from after that point. Readers can browse backward through when a certain character or item's description has changed and be linked to the page within the source content relevant to that change.

Database Information:

Table1 (cp_names): three columns - compares the URI to a post number
        an incrimenting number (just serving as a key)
        a URI
        a page number (not necessarily incrimenting)
Table2 (cp_contents): two columns - the json that we'll be working from for each post
        a number that corralates to table1
        a JSON value with categories and content items for those categories
Table3 (cp_items): four columns - the details for an item
        an incrimenting number (just serving as a key)
        the name of a content item
        the page number
        JSON block for data for that item.
Table4 (cp_styles): five columns - styles and layouts
        an incrimenting number (just serving as a key)
        the type of style it is ("full", "section", "single")
        the name of the style
        the page number
        JSON block for that style
Table5 (cp_types): three columns - what type of item each item is
        an incrimenting number (just serving as a key)
        an item name
        the type of item it is (e.g. "character", "setting")


Command lines begin with the string ">>> " followed by a command word.

Single items:
* >>> var [VARIABLE] - a variable to be interpreted by the script
* >>> comment [TEXT] - a comment that won't be interpreted y the parser
* >>> link [ITEM NAME] - an item name to convert into a URL
* >>> ilink [ITEM NAME] [TEXT] - Convert this to a link that will be opened in the iframe
* >>> plink [TEXT] - Convert this to a link for the previous version of the current item
* >>> nlink [TEXT] - Convert this to a link for the next version of the current item (only on single item view)
* >>> content - the next level of content in the "full"->"section"->"item" chain, or the iframe for "full" styles that single pages will go into. (in "full" styles, the "content" call is where the script will request the content for the next section, so it NEEDS to be present, even if you know that there will only be one section)

Indicate start or end positions
* >>> repeat ["start" OR "end"] - (only in "section" and "full") Everything in between repeats for each section or item (if multiple starts are present before an end, they will be used in sequence and loop until all sections or items have been used) (in "section" styles, the "repeat" call is when the script will request the content for the next item, so it NEEDS to be present, even if you know that there will only be one item).
* >>> not_first ["start" OR "end"] - (only in "section" and "full") Apply this to all items but the first
* >>> not_last ["start" OR "end"] - (only in  "section" and "full") Apply this to all items but the last
* >>> is_first ["start" OR "end"] - (only in "section" and "full") Apply this only to the first item
* >>> is_last ["start" OR "end"] - (only in  "section" and "full") Apply this only to the last item
* >>> is_prev ["start" OR "end"] - (only in "single" and "section") data that only appears if there's a previous item
* >>> is_next ["start" OR "end"] - (only in "single") data that only appears if there's a next item
* >>> no_prev ["start" OR "end"] - (only in "single" and "section") data that only appears if there is no previous item
* >>> no_next ["start" OR "end"] - (only in "single") data that only appears if there is no next item
* >>> head ["start" OR "end"] - indicates a section that goes into the header
* >>> iframe ["start" OR "end"] - indicates a section that goes into the div that surrounds the iframe
* >>> description ["start" OR "end"] - indicates the description for an item

Special data for items (must be listed before anything else):
* >>> disp_name - (only for items) The display name of the item
* >>> disp_image - (only for items) The image url for an item
* >>> item_data - (only for items) a varaible that can be used to store data about the item. Multiple of these can be used; they will be stored in an array

Special data for full page styles
* >>> single [NAME] - declare the single image style that should be used for the iframe

special data for content:
* >>> style - the style for the page (should be declared before any styles or items)
* >>> s_name - the name of the upcoming section (should be declared before the style) (There's no reason that this cannot contain any length of text or html)
* >>> s_style - the style of the upcoming section
* >>> item - an item within the section

Other special data (begins with ">>>>> "):
* >>>>> declare style [NAME] [PAGE] [TYPE]
* >>>>> declare name [URL] [PAGE]
* >>>>> declare content [PAGE]
* >>>>> declare item [NAME] [PAGE]
* >>>>> declare type [NAME] [TYPE]

Other Rules:
* Anything that needs to be parsed as plain html doesn't need to be preceeded with anything
* The following tags will be added programatically <head> </head> </body> <html> </html>
* Also, immediately after the <head> tag, some script stuff will be added
* All styles and item names will have to have internal names without spaces, given that the parsing is done based on whitespace.
* The full page version should nevver reference the next URL; to avoid spoilers, the source page is always treated as if it's the latest page.

Note: Other than the following exceptions, all lines beginning with ">>>" will be surrounded by new-line characters in the output html:
* var
* link


Internal Variables:
* ITEM_NAME - The name used internally to reference this item
* DISP_NAME - The display name of an item (note, there's no rreason why this cannot contain html)
* IMAGE - the image url for an item. These should be relative to the directory where index.php is located.
* ITEM_DATA [NUMBER (starting with 1)] - Other data for the item, stored as an array. So, for example, if you want to have a variable for the age of characters.
* SECTION_NAME - the display name of a section (note, there's no rreason why this cannot contain html)
* SOURCE_URL - the URL of the source page that this page is referencing
* MAIN_URL - the URL for the main page of this site (not the source site)
* SECT_NUM - the number of the current section (counting starts at zero)
* ITEM_NUM - The number of the current item in the current section (counting starts at zero)


Files:

* index.php - Calls the other files for the script
* config.php - Includes the configuration to connect to the database as well as specifics about the site in question
* parse.php - Includes the functions necessaey to parse the contents, items, and styles
* url.php - Parses the url and other data to determine what content needs to be loaded
* full.php - Loads a full page relative to a post from the source page
* connect.php - connects to mysql
* single.php - Loads a siingle page view
* js_top.txt - text that will be used to begin the full page view pages
* js_bottom.txt - additional text for the full page view pages containing the javascript that makes the links work



Any links generated by the script within the full page view will have the html class "cp_link". They will be presented in the following format:

	<a class="cp_link" href="#" src="" onclick="fn_open_link(this);return false;">link text</a>

where the value for "src" will be populated with the URL of the single item view. They will still have the same class within the single item view, but they will look like this instead:

	<a class="cp_link" href="">link text</a>

where the "href" attribute will be populated with the URL.



The iframe containing the single item view will be put in place with the ">>> content" indicator after beginning an ">>> iframe start" block. It will have the id "cp_single" and will be in this format:

	<iframe id="cp_single" src=""></iframe>

and the "src" attribute will be populated by javascript as needed.






